const U="treeview:";function y(e,r){return e.querySelector(r)}function g(e,r){return Array.from(e.querySelectorAll(r))}function J(e){try{return JSON.parse(sessionStorage.getItem(e)||"null")}catch{return null}}function V(e,r){try{sessionStorage.setItem(e,JSON.stringify(r))}catch{}}function G(e){const r=[];function t(i){const a=Array.from(i.children).filter(s=>s.matches('li[role="treeitem"]'));for(const s of a){if(s.classList.contains("hidden")||s.getAttribute("aria-hidden")==="true")continue;r.push(s);const l=s.querySelector(':scope > ul[role="group"]'),o=s.getAttribute("aria-expanded")==="true";l&&o&&!l.classList.contains("hidden")&&t(l)}}const n=y(e,'ul[role="tree"]');return n&&t(n),r}function X(e,r){let t=null;return function(...i){window.clearTimeout(t),t=window.setTimeout(()=>e.apply(this,i),r)}}function N(e){const r=y(e,'ul[role="tree"]');if(!r)return;function t(n,i){const a=Array.from(n.querySelectorAll(':scope > li[role="treeitem"]'));for(const s of a){s.__treeParent=i||null,s.__cb=s.querySelector(':scope input[type="checkbox"]');const l=s.querySelector(':scope > ul[role="group"]');s.__group=l||null,s.__childrenLis=l?Array.from(l.querySelectorAll(':scope > li[role="treeitem"]')):[],l&&t(l,s)}}t(r,null),e.__treeIndexed=!0,e.__indexStale=!1}function R(e){(!e.__treeIndexed||e.__indexStale)&&N(e)}function q(e){g(e,'li[role="treeitem"]').forEach(r=>{const t=r.querySelector(":scope > div [data-toggle]");if(!t)return;const n=r.getAttribute("aria-expanded")==="true",i=t.querySelector("[data-icon-collapsed]"),a=t.querySelector("[data-icon-expanded]");i&&i.classList.toggle("hidden",n),a&&a.classList.toggle("hidden",!n)})}function x(e,r,t=!0){!r||!y(e,'ul[role="tree"]')||(g(e,'li[role="treeitem"]').forEach(i=>i.tabIndex=-1),r.tabIndex=0,t&&r.focus())}function H(e,r,t){e.dispatchEvent(new CustomEvent(r,{detail:t,bubbles:!0}))}function B(e){if(!(e.dataset.persist==="true"))return;const t=e.id||e.dataset.persistKey||"default",n=g(e,'li[role="treeitem"][aria-expanded="true"]').map(i=>i.dataset.id);V(U+t,{expanded:n})}function Q(e){if(!(e.dataset.persist==="true"))return;const t=e.id||e.dataset.persistKey||"default",n=J(U+t);if(!n||!n.expanded)return;const i=new Set(n.expanded);g(e,'li[role="treeitem"]').forEach(a=>{if(!(!!a.querySelector(':scope > ul[role="group"]')||!!a.querySelector(':scope > ul[role="group"] > [data-lazy-placeholder]')))return;const l=a.querySelector("[data-toggle]"),o=a.querySelector(':scope > ul[role="group"]');if(i.has(a.dataset.id)&&(a.setAttribute("aria-expanded","true"),o&&o.classList.remove("hidden"),l)){const d=l.querySelector("[data-icon-collapsed]"),c=l.querySelector("[data-icon-expanded]");d&&d.classList.add("hidden"),c&&c.classList.remove("hidden")}}),q(e)}function M(e){g(e,'li[role="treeitem"]').forEach(r=>{r.removeAttribute("data-search-match"),r.removeAttribute("data-has-match-in-subtree"),r.classList.remove("hidden"),r.removeAttribute("aria-hidden");const t=r.querySelector(":scope > div[data-node-header]");t&&t.classList.remove("bg-warning/20");const n=r.querySelector(":scope > div [data-label]");n&&n.dataset.origLabel&&(n.textContent=n.dataset.origLabel,delete n.dataset.origLabel)}),g(e,"li[data-search-ellipsis]").forEach(r=>r.remove())}function W(e,r){const t=e.textContent||"";e.dataset.origLabel||(e.dataset.origLabel=t);const n=t.toLowerCase().indexOf(r.toLowerCase());if(n===-1)return;const i=t.slice(0,n),a=t.slice(n,n+r.length),s=t.slice(n+r.length);e.innerHTML=`${i}<mark>${a}</mark>${s}`}function Y(e,r){R(e);const t=a=>{const s=a.__childrenLis||[];let l=!1;for(const c of s)l=t(c)||l;const o=a.querySelector(":scope > div [data-label]"),u=(o?.textContent||"").toLowerCase(),d=r&&u.includes(r.toLowerCase());if(d&&o){const c=a.querySelector(":scope > div[data-node-header]");c&&c.classList.add("bg-warning/20"),W(o,r),a.setAttribute("data-search-match","1")}if(d||l){a.removeAttribute("aria-hidden"),a.classList.remove("hidden"),a.setAttribute("data-has-match-in-subtree","1");const c=a.__group||a.querySelector(':scope > ul[role="group"]'),f=a.hasAttribute("data-lazy-node");return c&&!f&&(a.setAttribute("aria-expanded","true"),c.classList.remove("hidden")),!0}return a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),!1},n=y(e,'ul[role="tree"]');if(!n)return;Array.from(n.querySelectorAll(':scope > li[role="treeitem"]')).forEach(a=>t(a)),Z(e)}function Z(e){g(e,"li[data-search-ellipsis]").forEach(t=>t.remove()),g(e,'ul[role="tree"], ul[role="group"]').forEach(t=>{if(t.classList.contains("hidden"))return;const n=Array.from(t.querySelectorAll(':scope > li[role="treeitem"]'));if(!n.length||n.filter(d=>d.classList.contains("hidden")||d.getAttribute("aria-hidden")==="true").length<=0)return;const a=t.closest('li[role="treeitem"]'),s=a&&parseInt(a.getAttribute("aria-level")||"0",10)||0,l=a?s+1:1,o=Math.max(0,l-1)*16,u=document.createElement("li");u.setAttribute("data-search-ellipsis","1"),u.setAttribute("role","presentation"),u.innerHTML=`
      <div class="flex items-center gap-2 px-2 py-1 rounded opacity-60" data-node-header="1" style="padding-left: ${o}px">
        <span class="inline-block w-6"></span>
        <span class="flex-1 select-none">…</span>
      </div>
    `,t.appendChild(u)})}async function ee(e,r,t){if(!Array.isArray(r)||r.length===0)return!1;const n=s=>e.querySelector(`li[role="treeitem"][data-id="${CSS.escape(String(s))}"]`);if(!n(r[0]))return!1;const a=(s,l,o=3e3)=>new Promise(u=>{const d=Date.now(),c=()=>{if(t&&e.__searchToken!==t)return u(null);const f=n(l);if(f)return u(f);if(Date.now()-d>=o)return u(null);setTimeout(c,30)};c()});for(let s=0;s<r.length-1;s++){if(t&&e.__searchToken!==t)return!1;const l=r[s],o=r[s+1],u=n(l);if(!u)return!1;if(u.getAttribute("aria-expanded")!=="true")m(e,u,!0);else if(u.hasAttribute("data-lazy-node")){const c=u.querySelector(':scope > ul[role="group"]'),f=!!(c&&c.querySelector(':scope > li[role="treeitem"]')),h=c&&c.querySelector(":scope > [data-lazy-placeholder]");f?h&&!f&&m(e,u,!0):m(e,u,!0)}if(!await a(u,o))return!1}return!0}async function te(e,r,t){const n=e.dataset.searchUrl,i=e.dataset.searchParam||"q";if(!n)return[];try{const a=(()=>{try{const c=new URL(n,window.location.origin);return c.searchParams.set(i,r),c.toString()}catch{const f=n.includes("?")?"&":"?";return`${n}${f}${encodeURIComponent(i)}=${encodeURIComponent(r)}`}})();e.__searchAbort&&e.__searchAbort.abort();const s=new AbortController;e.__searchAbort=s;const l=await fetch(a,{signal:s.signal});if(!l.ok)throw new Error("HTTP "+l.status);const o=await l.json(),d=(Array.isArray(o?.paths)?o.paths:Array.isArray(o)&&Array.isArray(o[0])?o:[]).slice(0,50);for(const c of d){if(t&&e.__searchToken!==t)return;const f=c.slice(0,Math.max(1,c.length-0));await ee(e,f,t)}return d}catch(a){return console.error("Tree search remote error",a),[]}}async function $(e,r){const t=parseInt(e.dataset.searchMin||"2",10)||2;if(parseInt(e.dataset.searchDebounce||"300",10),!r||r.length<t){M(e);return}e.__searchToken=(e.__searchToken||0)+1;const n=e.__searchToken;M(e),!(e.dataset.searchUrl&&(await te(e,r,n),n&&e.__searchToken!==n))&&(Y(e,r),q(e))}function m(e,r,t=void 0){if(!(!!r.querySelector(':scope > ul[role="group"]')||r.querySelector("[data-lazy-placeholder]")))return;const i=r.getAttribute("aria-expanded")==="true",a=t===void 0?!i:!!t,s=r.querySelector("[data-toggle]"),l=r.querySelector(':scope > ul[role="group"]');if(r.setAttribute("aria-expanded",a?"true":"false"),l&&l.classList.toggle("hidden",!a),s){const o=s.querySelector("[data-icon-collapsed]"),u=s.querySelector("[data-icon-expanded]");o&&o.classList.toggle("hidden",a),u&&u.classList.toggle("hidden",!a)}if(B(e),a&&r.hasAttribute("data-lazy-node")){const o=r.querySelector(':scope > ul[role="group"]');o&&(o.innerHTML='<li class="px-2 py-1 text-sm opacity-60" data-lazy-placeholder>Chargement…</li>'),e.__indexStale=!0,H(e,"tree:lazy",{root:e,nodeId:r.dataset.id,li:r})}}function z(e){let r=e;for(;r;){if(r.querySelector(":scope > div input[disabled]"))return!0;r=r.parentElement?.closest('li[role="treeitem"]')}return!1}function b(e,r){e&&(r==="checked"?(e.checked=!0,e.indeterminate=!1,e.setAttribute("aria-checked","true")):r==="unchecked"?(e.checked=!1,e.indeterminate=!1,e.setAttribute("aria-checked","false")):r==="mixed"&&(e.checked=!1,e.indeterminate=!0,e.setAttribute("aria-checked","mixed")))}function re(e,r){let t=r.parentElement?.closest('li[role="treeitem"]');for(;t;){const n=t.querySelector(':scope > ul[role="group"]'),i=n?Array.from(n.querySelectorAll(':scope > li input[type="checkbox"]')):[],a=i.filter(o=>o.checked).length,s=i.filter(o=>o.indeterminate).length,l=t.querySelector(':scope input[type="checkbox"]');i.length===0?b(l,"unchecked"):a===i.length&&s===0?b(l,"checked"):a===0&&s===0?b(l,"unchecked"):b(l,"mixed"),t=t.parentElement?.closest('li[role="treeitem"]')}}function ne(e,r){const t=n=>{const i=n.__childrenLis||[];for(const a of i){const s=a.__cb||a.querySelector(':scope input[type="checkbox"]');s&&!s.disabled&&b(s,r?"checked":"unchecked"),t(a)}};t(e)}function ae(e){const r=e.__group||e.querySelector(':scope > ul[role="group"]'),t=e.__cb||e.querySelector(':scope input[type="checkbox"]');if(!r||!t)return;const n=(e.__childrenLis||Array.from(r.querySelectorAll(':scope > li input[type="checkbox"]'))).map(s=>s.__cb||s.querySelector(':scope input[type="checkbox"]')).filter(Boolean),i=n.filter(s=>s.checked).length,a=n.filter(s=>s.indeterminate).length;n.length===0?b(t,"unchecked"):i===n.length&&a===0?b(t,"checked"):i===0&&a===0?b(t,"unchecked"):b(t,"mixed")}function j(e){(e.__childrenLis||[]).forEach(t=>j(t)),ae(e)}function P(e){const r=e.dataset.selection||"single";g(e,'li[role="treeitem"]').forEach(t=>{const n=t.querySelector(":scope > div[data-node-header]");if(!n)return;let i=!1;if(r==="multiple"){const a=t.querySelector(':scope input[type="checkbox"]');i=!!(a&&(a.checked||a.indeterminate))}else{const a=t.querySelector(':scope input[type="radio"]');i=!!(a&&a.checked)||t.getAttribute("aria-selected")==="true"}n.classList.toggle("bg-base-200",i)})}function E(e,r,t=!1,n=!1){if(y(e,'ul[role="tree"]').dataset.disabled==="true"||z(r))return;R(e);const i=e.dataset.selection||"single",a=r.querySelector(':scope input[type="radio"], :scope input[type="checkbox"]');if(i==="single"&&a&&a.type==="radio")a.checked=!0,g(e,'li[role="treeitem"]').forEach(s=>s.setAttribute("aria-selected",s===r?"true":"false"));else if(i==="multiple"&&a&&a.type==="checkbox"){const s=n?!!a.checked:!(a.checked||a.indeterminate);b(a,s?"checked":"unchecked"),ne(r,s),j(r),re(e,r),r.setAttribute("aria-selected",s?"true":"false")}else g(e,'li[role="treeitem"]').forEach(s=>s.setAttribute("aria-selected",s===r?"true":"false"));P(e),H(e,"tree:select",{nodeId:r.dataset.id,viaKeyboard:t})}function se(e,r){const t=document.activeElement?.closest('li[role="treeitem"]'),n=G(e);if(!n.length)return;let i=t?n.indexOf(t):-1;switch(r.key){case"ArrowDown":r.preventDefault(),x(e,n[Math.min(n.length-1,i+1)]);break;case"ArrowUp":r.preventDefault(),x(e,n[Math.max(0,i-1)]);break;case"ArrowRight":if(!t)return;if(r.preventDefault(),t.getAttribute("aria-expanded")==="false")m(e,t,!0);else{const a=t.querySelector(':scope > ul[role="group"]');if(a&&!a.classList.contains("hidden")){const s=a.querySelector('li[role="treeitem"]');s&&x(e,s)}}break;case"ArrowLeft":if(!t)return;if(r.preventDefault(),t.getAttribute("aria-expanded")==="true")m(e,t,!1);else{const a=t.parentElement?.closest('li[role="treeitem"]');a&&x(e,a)}break;case"Enter":case" ":if(!t)return;r.preventDefault(),E(e,t,!0);break}}function ie(e){const r=y(e,'ul[role="tree"]');if(r){if(N(e),r.addEventListener("keydown",t=>se(e,t)),r.addEventListener("click",t=>{const n=t.target,i=n.closest("[data-node-header]"),a=n.closest('li[role="treeitem"]');if(a){if(y(e,'ul[role="tree"]').dataset.disabled==="true"){n.closest("[data-toggle]")&&m(e,a);return}if(n.closest("[data-toggle]")){m(e,a),x(e,a);return}i&&n.closest("[data-label]")&&(e.dataset.selectLabel==="true"&&m(e,a),z(a)||E(e,a,!1),x(e,a))}}),r.addEventListener("mousedown",t=>{const n=t.target;n instanceof HTMLInputElement&&n.type==="checkbox"&&(n.dataset.wasIndeterminate=n.indeterminate?"1":"0")},{capture:!0}),r.addEventListener("change",t=>{const n=t.target;if(!(n instanceof HTMLInputElement)||n.type!=="checkbox"&&n.type!=="radio")return;const i=n.closest('li[role="treeitem"]');if(i&&y(e,'ul[role="tree"]').dataset.disabled!=="true"){if(z(i)){n.type==="checkbox"?b(n,"unchecked"):n.checked=!1;return}if(n.type==="checkbox"&&n.dataset.wasIndeterminate==="1"){b(n,"unchecked"),n.indeterminate=!1,n.setAttribute("aria-checked","false"),delete n.dataset.wasIndeterminate,E(e,i,!1,!0);return}n.type==="checkbox"&&(n.indeterminate=!1,n.setAttribute("aria-checked",n.checked?"true":"false")),E(e,i,!1,!0)}}),r.addEventListener("dblclick",t=>{const n=t.target.closest('li[role="treeitem"]');n&&m(e,n)}),e.dataset.lazyUrl){const t=e.dataset.selection||"single",n=y(e,'ul[role="tree"]').dataset.radioName||(e.id?e.id+"-group":"tree-group"),i=(y(e,'input[type="radio"]')?.className||"radio radio-sm")+" shrink-0",a=(y(e,'input[type="checkbox"]')?.className||"checkbox checkbox-sm")+" shrink-0",s=y(e,"[data-toggle]")?.innerHTML||'<span data-icon-collapsed>▸</span><span data-icon-expanded class="hidden">▾</span>',l=(()=>{try{const d=document.createElement("div");d.innerHTML=s;const c=d.querySelector("[data-icon-collapsed]"),f=d.querySelector("[data-icon-expanded]");return c&&c.classList.remove("hidden"),f&&f.classList.add("hidden"),d.innerHTML}catch{return'<span data-icon-collapsed>▸</span><span data-icon-expanded class="hidden">▾</span>'}})(),o=(d,c,f=!1)=>{const h=d.id,L=d.label??String(d.id),k=!!d.disabled||!!f,S=k?" disabled":"",A=!!d.lazy,C=Array.isArray(d.children)?d.children:[],v=A||C.length>0,O=Math.max(0,c-1)*16,I=t==="multiple"?`<input type="checkbox" class="${a}" tabindex="-1"${S} />`:`<input type="radio" name="${n}" class="${i}" tabindex="-1"${S} />`,T=v?`<button type="button" class="btn btn-ghost btn-xs btn-square" aria-label="Toggle" data-toggle="1" tabindex="-1">${l}</button>`:'<span class="inline-block w-6"></span>';let p="";return p+=`<li role="treeitem" aria-level="${c}" aria-expanded="false" aria-selected="false" data-id="${String(h)}" class="outline-none"${A?' data-lazy-node="1"':""}>`,p+=`  <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-base-200 focus:bg-base-200" data-node-header="1" style="padding-left: ${O}px">`,p+=`    ${T}`,p+=`    ${I}`,p+=`    <span class="${`flex-1 cursor-default select-none${k?" opacity-50":""}`}" data-label="1">${L}</span>`,p+="  </div>",v&&(p+='  <ul role="group" class="pl-2 ml-4 border-l border-base-300 hidden" data-children="1">',A?p+='    <li class="px-2 py-1 text-sm opacity-60 hidden" data-lazy-placeholder="1">Loading…</li>':C.forEach(w=>{p+=o(w,c+1,k)}),p+="  </ul>"),p+="</li>",p},u=(d,c,f)=>{try{const h=new URL(d,window.location.origin);return h.searchParams.set(c,String(f)),h.toString()}catch{const L=d.includes("?")?"&":"?";return`${d}${L}${encodeURIComponent(c)}=${encodeURIComponent(String(f))}`}};e.addEventListener("tree:lazy",async d=>{const{li:c,nodeId:f}=d.detail||{};if(!c)return;const h=c.querySelector(':scope > ul[role="group"]');if(!h)return;h.querySelector("[data-lazy-placeholder]")||(h.innerHTML='<li class="px-2 py-1 text-sm opacity-60" data-lazy-placeholder>Chargement…</li>');const L=e.dataset.lazyParam||"node",k=u(e.dataset.lazyUrl,L,f);try{const S=await fetch(k);if(!S.ok)throw new Error("HTTP "+S.status);const A=await S.json(),v=(parseInt(c.getAttribute("aria-level")||"0",10)||0)+1,O=h.querySelector(":scope > [data-lazy-placeholder]"),I=!!c.querySelector(":scope > div input[disabled]"),T=(A||[]).map(_=>o(_,v,I)).join("");h.innerHTML="",h.insertAdjacentHTML("afterbegin",T),c.setAttribute("aria-expanded","true");const p=c.querySelector("[data-toggle]");if(p){const _=p.querySelector("[data-icon-collapsed]"),w=p.querySelector("[data-icon-expanded]");_&&_.classList.add("hidden"),w&&w.classList.remove("hidden")}}catch(S){h.innerHTML='<li class="px-2 py-1 text-error">Erreur de chargement</li>',console.error("Tree lazy auto-load error",S)}e.__indexStale=!0,P(e),q(e)})}if(e.dataset.searchEnabled==="true"){const t=y(e,"[data-tree-search]"),n=y(e,"[data-tree-search-btn]"),i=parseInt(e.dataset.searchDebounce||"300",10)||300,a=X(()=>{t&&$(e,t.value.trim())},i);t&&(t.addEventListener("input",()=>{const s=parseInt(e.dataset.searchMin||"2",10)||2;(!t.value||t.value.trim().length<s)&&M(e),e.dataset.searchAuto==="true"&&a()}),t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),$(e,t.value.trim()))})),n&&t&&n.addEventListener("click",()=>{$(e,t.value.trim())})}}}function F(e){const r=e.dataset.selection||"single",t=y(e,'ul[role="tree"]').dataset.return||"nodes";if(r==="multiple")return t==="leaves"?g(e,'li[role="treeitem"] input[type="checkbox"]:checked').map(a=>a.closest("li")).filter(a=>!a.querySelector(':scope > ul[role="group"] li[role="treeitem"]')).map(a=>a?.dataset.id).filter(Boolean):g(e,'li[role="treeitem"] input[type="checkbox"]:checked').map(a=>a.closest("li")?.dataset.id).filter(Boolean);const n=e.querySelector('li[role="treeitem"] input[type="radio"]:checked');if(n)return[n.closest("li")?.dataset.id].filter(Boolean);const i=e.querySelector('li[role="treeitem"][aria-selected="true"]');return i?[i.dataset.id]:[]}function ce(e,r){H(e,"tree:setData",{data:r})}function le(e){g(e,'li[role="treeitem"]').forEach(r=>{r.setAttribute("aria-selected","false"),r.classList.remove("bg-base-200");const t=r.querySelector('input[type="checkbox"]'),n=r.querySelector('input[type="radio"]');t&&(t.checked=!1),n&&(n.checked=!1)}),B(e)}function de(e){return{expand:r=>{const t=e.querySelector(`li[role="treeitem"][data-id="${CSS.escape(String(r))}"]`);t&&m(e,t,!0)},collapse:r=>{const t=e.querySelector(`li[role="treeitem"][data-id="${CSS.escape(String(r))}"]`);t&&m(e,t,!1)},toggle:r=>{const t=e.querySelector(`li[role="treeitem"][data-id="${CSS.escape(String(r))}"]`);t&&m(e,t)},getSelected:()=>F(e),setData:r=>ce(e,r),reset:()=>le(e)}}function K(e){if(!e||e.__treeInit)return;e.__treeInit=!0,ie(e),Q(e),P(e),q(e);function r(n){if(n.dataset.autofocus!=="true"||document.querySelector(":target")||location.hash&&location.hash.length>1)return!1;const i=document.activeElement;return!(i&&i!==document.body)}const t=e.querySelector('li[role="treeitem"]');t&&x(e,t,!1),t&&r(e)&&x(e,t,!0),e.__treeApi=de(e)}function D(){document.querySelectorAll('[data-treeview="1"]').forEach(e=>{if(e.__treeInit){q(e);return}K(e)})}window.DaisyTreeView={init:K,initAll:D,getSelected(e){return F(e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();
