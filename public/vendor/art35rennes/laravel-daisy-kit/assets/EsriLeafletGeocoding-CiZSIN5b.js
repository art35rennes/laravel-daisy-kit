import{a as r}from"./leaflet-src-DS0yb_yE.js";import{T as g,E as v,e as m,k as b,M as x}from"./FeatureLayer-TlSHTldR.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./leaflet-src-DCIffZry.js";const G="3.1.6";var _="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/",C=g.extend({path:"findAddressCandidates",params:{outSr:4326,forStorage:!1,outFields:"*",maxLocations:20},setters:{address:"address",neighborhood:"neighborhood",city:"city",subregion:"subregion",region:"region",postal:"postal",country:"country",text:"singleLine",category:"category",token:"token",apikey:"apikey",key:"magicKey",fields:"outFields",forStorage:"forStorage",maxLocations:"maxLocations",countries:"sourceCountry"},initialize:function(t){t=t||{},t.url=t.url||_,g.prototype.initialize.call(this,t)},within:function(t){return t=r.latLngBounds(t),this.params.searchExtent=v.boundsToExtent(t),this},nearby:function(t,e){var i=r.latLng(t);return this.params.location=i.lng+","+i.lat,e&&(this.params.distance=Math.min(Math.max(e,2e3),5e4)),this},run:function(t,e){return this.options.token&&(this.params.token=this.options.token),this.options.apikey&&(this.params.token=this.options.apikey),this.options.customParam&&(this.params[this.options.customParam]=this.params.singleLine,delete this.params.singleLine),this.request(function(i,s){var o=this._processGeocoderResponse,n=i?void 0:o(s);t.call(e,i,{results:n},s)},this)},_processGeocoderResponse:function(t){for(var e=[],i=0;i<t.candidates.length;i++){var s=t.candidates[i];if(s.extent)var o=v.extentToBounds(s.extent);e.push({text:s.address,bounds:o,score:s.score,latlng:r.latLng(s.location.y,s.location.x),properties:s.attributes})}return e}});function L(t){return new C(t)}var k=g.extend({path:"reverseGeocode",params:{outSR:4326,returnIntersection:!1},setters:{distance:"distance",language:"langCode",intersection:"returnIntersection",apikey:"apikey"},initialize:function(t){t=t||{},t.url=t.url||_,g.prototype.initialize.call(this,t)},latlng:function(t){var e=r.latLng(t);return this.params.location=e.lng+","+e.lat,this},run:function(t,e){return this.options.token&&(this.params.token=this.options.token),this.options.apikey&&(this.params.token=this.options.apikey),this.request(function(i,s){var o;i?o=void 0:o={latlng:r.latLng(s.location.y,s.location.x),address:s.address},t.call(e,i,o,s)},this)}});function w(t){return new k(t)}var D=g.extend({path:"suggest",params:{},setters:{text:"text",category:"category",countries:"countryCode",maxSuggestions:"maxSuggestions"},initialize:function(t){t=t||{},t.url||(t.url=_,t.supportsSuggest=!0),g.prototype.initialize.call(this,t)},within:function(t){t=r.latLngBounds(t);var e=t.getCenter(),i=t.getNorthWest();return this.params.location=e.lng+","+e.lat,this.params.distance=Math.min(Math.max(e.distanceTo(i),2e3),5e4),this.params.searchExtent=v.boundsToExtent(t),this},nearby:function(t,e){var i=r.latLng(t);return this.params.location=i.lng+","+i.lat,e&&(this.params.distance=Math.min(Math.max(e,2e3),5e4)),this},run:function(t,e){if(this.options.supportsSuggest)return this.request(function(i,s){t.call(e,i,s,s)},this);console.warn("this geocoding service does not support asking for suggestions")}});function E(t){return new D(t)}var y=m.extend({initialize:function(t){t=t||{},t.apikey&&(t.token=t.apikey),t.url?(m.prototype.initialize.call(this,t),this._confirmSuggestSupport()):(t.url=_,t.supportsSuggest=!0,m.prototype.initialize.call(this,t))},geocode:function(){return L(this)},reverse:function(){return w(this)},suggest:function(){return E(this)},_confirmSuggestSupport:function(){this.metadata(function(t,e){t||(e.capabilities?e.capabilities.indexOf("Suggest")>-1?this.options.supportsSuggest=!0:this.options.supportsSuggest=!1:this.options.supportsSuggest=!1,this.options.customParam=e.singleLineAddressField.name)},this)}});function W(t){return new y(t)}var B=r.Evented.extend({options:{zoomToResult:!0,useMapBounds:12,searchBounds:null},initialize:function(t,e){if(r.Util.setOptions(this,e),this._control=t,!e||!e.providers||!e.providers.length)throw new Error("You must specify at least one provider");this._providers=e.providers},_geocode:function(t,e,i){var s=0,o=[],n,a=r.Util.bind(function(u,c){s--,!u&&(c&&(o=o.concat(c)),s<=0&&(n=this._boundsFromResults(o),this.fire("results",{results:o,bounds:n,latlng:n?n.getCenter():void 0,text:t},!0),this.options.zoomToResult&&n&&this._control._map.fitBounds(n),this.fire("load")))},this);if(e)s++,i.results(t,e,this._searchBounds(),a);else for(var l=0;l<this._providers.length;l++)s++,this._providers[l].results(t,e,this._searchBounds(),a)},_suggest:function(t){var e=this._providers.length,i=0,s=r.Util.bind(function(l,u){return r.Util.bind(function(c,h){if(e=e-1,i+=h.length,c){this._control._clearProviderSuggestions(u),this._control._finalizeSuggestions(e,i);return}if(h.length)for(var p=0;p<h.length;p++)h[p].provider=u;else this._control._renderSuggestions(h);u._lastRender!==l&&this._control._clearProviderSuggestions(u),h.length&&this._control._input.value===l&&(u._lastRender=l,this._control._renderSuggestions(h)),this._control._finalizeSuggestions(e,i)},this)},this);this._pendingSuggestions=[];for(var o=0;o<this._providers.length;o++){var n=this._providers[o],a=n.suggestions(t,this._searchBounds(),s(t,n));this._pendingSuggestions.push(a)}},_searchBounds:function(){return this.options.searchBounds!==null?this.options.searchBounds:this.options.useMapBounds===!1?null:this.options.useMapBounds===!0?this._control._map.getBounds():this.options.useMapBounds<=this._control._map.getZoom()?this._control._map.getBounds():null},_boundsFromResults:function(t){if(t.length){for(var e=r.latLngBounds([0,0],[0,0]),i=[],s=[],o=t.length-1;o>=0;o--){var n=t[o];s.push(n.latlng),n.bounds&&n.bounds.isValid()&&!n.bounds.equals(e)&&i.push(n.bounds)}for(var a=r.latLngBounds(s),l=0;l<i.length;l++)a.extend(i[l]);return a}},_getAttribution:function(){for(var t=[],e=this._providers,i=0;i<e.length;i++)e[i].options.attribution&&t.push(e[i].options.attribution);return t.join(", ")}});function F(t,e){return new B(t,e)}var U=y.extend({options:{label:"Places and Addresses",maxResults:5},suggestions:function(t,e,i){var s=this.suggest().text(t);return e&&s.within(e),this.options.nearby&&s.nearby(this.options.nearby),this.options.countries&&s.countries(this.options.countries),this.options.categories&&s.category(this.options.categories),s.maxSuggestions(this.options.maxResults),s.run(function(o,n,a){var l=[];if(!o)for(;a.suggestions.length&&l.length<=this.options.maxResults-1;){var u=a.suggestions.shift();u.isCollection||l.push({text:u.text,unformattedText:u.text,magicKey:u.magicKey})}i(o,l)},this)},results:function(t,e,i,s){var o=this.geocode().text(t);return e&&o.key(e),o.maxLocations(this.options.maxResults),i&&o.within(i),this.options.forStorage&&o.forStorage(!0),this.options.nearby&&o.nearby(this.options.nearby),this.options.countries&&o.countries(this.options.countries),this.options.categories&&o.category(this.options.categories),o.run(function(n,a){s(n,a.results)},this)}});function R(t){return new U(t)}var M=r.Control.extend({includes:r.Evented.prototype,options:{position:"topleft",collapseAfterResult:!0,expanded:!1,allowMultipleResults:!0,placeholder:"Search for places or addresses",title:"Location Search"},initialize:function(t){r.Util.setOptions(this,t),(!t||!t.providers||!t.providers.length)&&(t||(t={}),t.providers=[R()]),this._geosearchCore=F(this,t),this._geosearchCore._providers=t.providers,this._geosearchCore.addEventParent(this);for(var e=0;e<this._geosearchCore._providers.length;e++)this._geosearchCore._providers[e].addEventParent(this);this._geosearchCore._pendingSuggestions=[],r.Control.prototype.initialize.call(this,t)},_renderSuggestions:function(t){var e;t.length>0&&(this._suggestions.style.display="block");for(var i,s,o=[],n=0;n<t.length;n++){var a=t[n];if(!s&&this._geosearchCore._providers.length>1&&e!==a.provider.options.label&&(s=r.DomUtil.create("div","geocoder-control-header",a.provider._contentsElement),s.textContent=a.provider.options.label,s.innerText=a.provider.options.label,e=a.provider.options.label),i||(i=r.DomUtil.create("ul","geocoder-control-list",a.provider._contentsElement)),o.indexOf(a.text)===-1){var l=r.DomUtil.create("li","geocoder-control-suggestion",i);l.innerHTML=a.text,l.provider=a.provider,l["data-magic-key"]=a.magicKey,l.unformattedText=a.unformattedText}else for(var u=0;u<i.childNodes.length;u++)i.childNodes[u].innerHTML===a.text&&(i.childNodes[u]["data-magic-key"]+=","+a.magicKey);o.push(a.text)}this.getPosition().indexOf("top")>-1&&(this._suggestions.style.maxHeight=this._map.getSize().y-this._suggestions.offsetTop-this._wrapper.offsetTop-10+"px"),this.getPosition().indexOf("bottom")>-1&&this._setSuggestionsBottomPosition()},_setSuggestionsBottomPosition:function(){this._suggestions.style.maxHeight=this._map.getSize().y-this._map._controlCorners[this.getPosition()].offsetHeight-this._wrapper.offsetHeight+"px",this._suggestions.style.top=-this._suggestions.offsetHeight-this._wrapper.offsetHeight+20+"px"},_boundsFromResults:function(t){if(t.length){for(var e=r.latLngBounds([0,0],[0,0]),i=[],s=[],o=t.length-1;o>=0;o--){var n=t[o];s.push(n.latlng),n.bounds&&n.bounds.isValid()&&!n.bounds.equals(e)&&i.push(n.bounds)}for(var a=r.latLngBounds(s),l=0;l<i.length;l++)a.extend(i[l]);return a}},clear:function(){this._clearAllSuggestions(),this.options.collapseAfterResult&&(this._input.value="",this._lastValue="",this._input.placeholder="",r.DomUtil.removeClass(this._wrapper,"geocoder-control-expanded")),!this._map.scrollWheelZoom.enabled()&&this._map.options.scrollWheelZoom&&this._map.scrollWheelZoom.enable()},_clearAllSuggestions:function(){this._suggestions.style.display="none";for(var t=0;t<this.options.providers.length;t++)this._clearProviderSuggestions(this.options.providers[t])},_clearProviderSuggestions:function(t){t._contentsElement.innerHTML=""},_finalizeSuggestions:function(t,e){t||(r.DomUtil.removeClass(this._input,"geocoder-control-loading"),this.getPosition().indexOf("bottom")>-1&&this._setSuggestionsBottomPosition(),e||this._clearAllSuggestions())},_setupClick:function(){r.DomUtil.addClass(this._wrapper,"geocoder-control-expanded"),this._input.focus()},disable:function(){this._input.disabled=!0,r.DomUtil.addClass(this._input,"geocoder-control-input-disabled"),r.DomEvent.removeListener(this._wrapper,"click",this._setupClick,this)},enable:function(){this._input.disabled=!1,r.DomUtil.removeClass(this._input,"geocoder-control-input-disabled"),r.DomEvent.addListener(this._wrapper,"click",this._setupClick,this)},getAttribution:function(){for(var t=[],e=0;e<this._providers.length;e++)this._providers[e].options.attribution&&t.push(this._providers[e].options.attribution);return t.join(", ")},geocodeSuggestion:function(t){var e=t.target||t.srcElement;e.classList.contains("geocoder-control-suggestions")||e.classList.contains("geocoder-control-header")||(e.classList.length<1&&(e=e.parentNode),this._geosearchCore._geocode(e.unformattedText,e["data-magic-key"],e.provider),this.clear())},onAdd:function(t){v.setEsriAttribution(t),this._map=t,this._wrapper=r.DomUtil.create("div","geocoder-control"),this._input=r.DomUtil.create("input","geocoder-control-input leaflet-bar",this._wrapper),this._input.title=this.options.title,this.options.expanded&&(r.DomUtil.addClass(this._wrapper,"geocoder-control-expanded"),this._input.placeholder=this.options.placeholder),this._suggestions=r.DomUtil.create("div","geocoder-control-suggestions leaflet-bar",this._wrapper);for(var e=0;e<this.options.providers.length;e++)this.options.providers[e]._contentsElement=r.DomUtil.create("div",null,this._suggestions);var i=this._geosearchCore._getAttribution();return t.attributionControl&&t.attributionControl.addAttribution(i),r.DomEvent.addListener(this._input,"focus",function(s){this._input.placeholder=this.options.placeholder,r.DomUtil.addClass(this._wrapper,"geocoder-control-expanded")},this),r.DomEvent.addListener(this._wrapper,"click",this._setupClick,this),r.DomEvent.addListener(this._suggestions,"mousedown",this.geocodeSuggestion,this),r.DomEvent.addListener(this._input,"blur",function(s){this.clear()},this),r.DomEvent.addListener(this._input,"keydown",function(s){var o=(s.target||s.srcElement).value;r.DomUtil.addClass(this._wrapper,"geocoder-control-expanded");for(var n=this._suggestions.querySelectorAll(".geocoder-control-suggestion"),a=this._suggestions.querySelectorAll(".geocoder-control-selected")[0],l,u=0;u<n.length;u++)if(n[u]===a){l=u;break}switch(s.keyCode){case 13:a?(this._input.value=a.innerText,this._geosearchCore._geocode(a.unformattedText,a["data-magic-key"],a.provider),this.clear()):this.options.allowMultipleResults&&o.length>=2?(this._geosearchCore._geocode(this._input.value,void 0),this.clear()):n.length===1?(r.DomUtil.addClass(n[0],"geocoder-control-selected"),this._geosearchCore._geocode(n[0].innerHTML,n[0]["data-magic-key"],n[0].provider)):(this.clear(),this._input.blur()),r.DomEvent.preventDefault(s);break;case 38:a&&r.DomUtil.removeClass(a,"geocoder-control-selected");var c=n[l-1];a&&c?r.DomUtil.addClass(c,"geocoder-control-selected"):r.DomUtil.addClass(n[n.length-1],"geocoder-control-selected"),r.DomEvent.preventDefault(s);break;case 40:a&&r.DomUtil.removeClass(a,"geocoder-control-selected");var h=n[l+1];a&&h?r.DomUtil.addClass(h,"geocoder-control-selected"):r.DomUtil.addClass(n[0],"geocoder-control-selected"),r.DomEvent.preventDefault(s);break;default:for(var p=0;p<this._geosearchCore._pendingSuggestions.length;p++){var d=this._geosearchCore._pendingSuggestions[p];d&&d.abort&&!d.id&&d.abort()}break}},this),r.DomEvent.addListener(this._input,"keyup",r.Util.throttle(function(s){var o=s.which||s.keyCode,n=(s.target||s.srcElement).value;if(n.length<2){this._lastValue=this._input.value,this._clearAllSuggestions(),r.DomUtil.removeClass(this._input,"geocoder-control-loading");return}if(o===27){this._clearAllSuggestions();return}o!==13&&o!==38&&o!==40&&this._input.value!==this._lastValue&&(this._lastValue=this._input.value,r.DomUtil.addClass(this._input,"geocoder-control-loading"),this._geosearchCore._suggest(n))},50,this),this),r.DomEvent.disableClickPropagation(this._wrapper),r.DomEvent.addListener(this._suggestions,"mouseover",function(s){t.scrollWheelZoom.enabled()&&t.options.scrollWheelZoom&&t.scrollWheelZoom.disable()}),r.DomEvent.addListener(this._suggestions,"mouseout",function(s){!t.scrollWheelZoom.enabled()&&t.options.scrollWheelZoom&&t.scrollWheelZoom.enable()}),this._geosearchCore.on("load",function(s){r.DomUtil.removeClass(this._input,"geocoder-control-loading"),this.clear(),this._input.blur()},this),this._wrapper}});function K(t){return new M(t)}var P=b.extend({options:{label:"Feature Layer",maxResults:5,bufferRadius:1e3,searchMode:"contain",formatSuggestion:function(t){return t.properties[this.options.searchFields[0]]}},initialize:function(t){t.apikey&&(t.token=t.apikey),b.prototype.initialize.call(this,t),typeof this.options.searchFields=="string"&&(this.options.searchFields=[this.options.searchFields]),this._suggestionsQuery=this.query(),this._resultsQuery=this.query()},suggestions:function(t,e,i){var s=this._suggestionsQuery.where(this._buildQuery(t)).returnGeometry(!1);e&&s.intersects(e),this.options.idField&&s.fields([this.options.idField].concat(this.options.searchFields));var o=s.run(function(n,a,l){if(n)i(n,[]);else{this.options.idField=l.objectIdFieldName;for(var u=[],c=a.features.length-1;c>=0;c--){var h=a.features[c];u.push({text:this.options.formatSuggestion.call(this,h),unformattedText:h.properties[this.options.searchFields[0]],magicKey:h.id})}i(n,u.slice(0,this.options.maxResults))}},this);return o},results:function(t,e,i,s){var o=this._resultsQuery;return e?(delete o.params.where,o.featureIds([e])):o.where(this._buildQuery(t)),i&&o.within(i),o.run(r.Util.bind(function(n,a){for(var l=[],u=0;u<a.features.length;u++){var c=a.features[u];if(c){var h=this._featureBounds(c),p={latlng:h.getCenter(),bounds:h,text:this.options.formatSuggestion.call(this,c),properties:c.properties,geojson:c};l.push(p),delete this._resultsQuery.params.objectIds}}s(n,l)},this))},orderBy:function(t,e){this._suggestionsQuery.orderBy(t,e)},_buildQuery:function(t){for(var e=[],i=this.options.searchFields.length-1;i>=0;i--){var s='upper("'+this.options.searchFields[i]+'")';if(this.options.searchMode==="contain")e.push(s+" LIKE upper('%"+t+"%')");else if(this.options.searchMode==="startWith")e.push(s+" LIKE upper('"+t+"%')");else if(this.options.searchMode==="endWith")e.push(s+" LIKE upper('%"+t+"')");else if(this.options.searchMode==="strict")e.push(s+" LIKE upper('"+t+"')");else throw new Error('L.esri.Geocoding.featureLayerProvider: Invalid parameter for "searchMode". Use one of "contain", "startWith", "endWith", or "strict"')}return this.options.where?this.options.where+" AND ("+e.join(" OR ")+")":e.join(" OR ")},_featureBounds:function(t){var e=r.geoJson(t);if(t.geometry.type==="Point"){var i=e.getBounds().getCenter(),s=this.options.bufferRadius/40075017*360/Math.cos(180/Math.PI*i.lat),o=this.options.bufferRadius/40075017*360;return r.latLngBounds([i.lat-o,i.lng-s],[i.lat+o,i.lng+s])}else return e.getBounds()}});function O(t){return new P(t)}var T=x.extend({options:{layers:[0],label:"Map Service",bufferRadius:1e3,maxResults:5,formatSuggestion:function(t){return t.properties[t.displayFieldName]+" <small>"+t.layerName+"</small>"}},initialize:function(t){t.apikey&&(t.token=t.apikey),x.prototype.initialize.call(this,t),this._getIdFields()},suggestions:function(t,e,i){var s=this.find().text(t).fields(this.options.searchFields).returnGeometry(!1).layers(this.options.layers);return s.run(function(o,n,a){var l=[];if(!o){var u=Math.min(this.options.maxResults,n.features.length);a.results=a.results.reverse();for(var c=0;c<u;c++){var h=n.features[c],p=a.results[c],d=p.layerId,f=this._idFields[d];h.layerId=d,h.layerName=this._layerNames[d],h.displayFieldName=this._displayFields[d],f&&l.push({text:this.options.formatSuggestion.call(this,h),unformattedText:h.properties[h.displayFieldName],magicKey:p.attributes[f]+":"+d})}}i(o,l.reverse())},this)},results:function(t,e,i,s){var o=[],n;if(e&&!e.includes(",")){var a=e.split(":")[0],l=e.split(":")[1];n=this.query().layer(l).featureIds(a)}else n=this.find().text(t).fields(this.options.searchFields).layers(this.options.layers);return n.run(function(u,c,h){if(!u){h.results&&(h.results=h.results.reverse());for(var p=0;p<c.features.length;p++){var d=c.features[p];if(l=l||h.results[p].layerId,d&&l!==void 0){var f=this._featureBounds(d);d.layerId=l,d.layerName=this._layerNames[l],d.displayFieldName=this._displayFields[l];var S={latlng:f.getCenter(),bounds:f,text:this.options.formatSuggestion.call(this,d),properties:d.properties,geojson:d};o.push(S)}}}s(u,o.reverse())},this)},_featureBounds:function(t){var e=r.geoJson(t);if(t.geometry.type==="Point"){var i=e.getBounds().getCenter(),s=this.options.bufferRadius/40075017*360/Math.cos(180/Math.PI*i.lat),o=this.options.bufferRadius/40075017*360;return r.latLngBounds([i.lat-o,i.lng-s],[i.lat+o,i.lng+s])}else return e.getBounds()},_layerMetadataCallback:function(t){return r.Util.bind(function(e,i){if(!e){this._displayFields[t]=i.displayField,this._layerNames[t]=i.name;for(var s=0;s<i.fields.length;s++){var o=i.fields[s];if(o.type==="esriFieldTypeOID"){this._idFields[t]=o.name;break}}}},this)},_getIdFields:function(){this._idFields={},this._displayFields={},this._layerNames={};for(var t=0;t<this.options.layers.length;t++){var e=this.options.layers[t];this.get(e,{},this._layerMetadataCallback(e))}}});function H(t){return new T(t)}var z=y.extend({options:{label:"Geocode Server",maxResults:5},suggestions:function(t,e,i){if(this.options.supportsSuggest){var s=this.suggest().text(t);return e&&s.within(e),s.run(function(o,n,a){var l=[];if(!o)for(;a.suggestions.length&&l.length<=this.options.maxResults-1;){var u=a.suggestions.shift();u.isCollection||l.push({text:u.text,unformattedText:u.text,magicKey:u.magicKey})}i(o,l)},this)}else return i(null,[]),!1},results:function(t,e,i,s){var o=this.geocode().text(t);return e&&o.key(e),o.maxLocations(this.options.maxResults),i&&o.within(i),o.run(function(n,a){s(n,a.results)},this)}});function Z(t){return new z(t)}export{U as ArcgisOnlineProvider,P as FeatureLayerProvider,C as Geocode,y as GeocodeService,z as GeocodeServiceProvider,M as Geosearch,B as GeosearchCore,T as MapServiceProvider,k as ReverseGeocode,D as Suggest,G as VERSION,_ as WorldGeocodingServiceUrl,R as arcgisOnlineProvider,O as featureLayerProvider,L as geocode,W as geocodeService,Z as geocodeServiceProvider,K as geosearch,F as geosearchCore,H as mapServiceProvider,w as reverseGeocode,E as suggest};
