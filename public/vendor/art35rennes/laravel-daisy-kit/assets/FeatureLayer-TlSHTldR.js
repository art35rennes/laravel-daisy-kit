import{a}from"./leaflet-src-DS0yb_yE.js";const w=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,m=document.documentElement.style.pointerEvents==="",_={cors:w,pointerEvents:m},lt={attributionWidthOffset:55};let J=0;function R(t){let e="";t.f=t.f||"json";for(const s in t)if(Object.hasOwn(t,s)){const r=t[s],o=Object.prototype.toString.call(r);let n;e.length&&(e+="&"),o==="[object Array]"?n=Object.prototype.toString.call(r[0])==="[object Object]"?JSON.stringify(r):r.join(","):o==="[object Object]"?n=JSON.stringify(r):o==="[object Date]"?n=r.valueOf():n=r,e+=`${encodeURIComponent(s)}=${encodeURIComponent(n)}`}return e.replaceAll("'","%27")}function B(t,e){const i=new window.XMLHttpRequest;return i.onerror=function(){i.onreadystatechange=a.Util.falseFn,t.call(e,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){let s,r;if(i.readyState===4){try{s=JSON.parse(i.responseText)}catch{s=null,r={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!r&&s.error&&(r=s.error,s=null),i.onerror=a.Util.falseFn,t.call(e,r,s)}},i.ontimeout=function(){this.onerror()},i}function ut(t,e,i,s){const r=B(i,s);return r.open("POST",t),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(r.timeout=s.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(R(e)),r}function j(t,e,i,s){const r=B(i,s);return r.open("GET",`${t}?${R(e)}`,!0),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(r.timeout=s.options.timeout,s.options.withCredentials&&(r.withCredentials=!0)),r.send(null),r}function Q(t,e,i,s){const r=R(e),o=B(i,s),n=`${t}?${r}`.length;if(n<=2e3&&_.cors?o.open("GET",`${t}?${r}`):n>2e3&&_.cors&&(o.open("POST",t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(o.timeout=s.options.timeout,s.options.withCredentials&&(o.withCredentials=!0)),n<=2e3&&_.cors)o.send(null);else if(n>2e3&&_.cors)o.send(r);else{if(n<=2e3&&!_.cors)return D(t,e,i,s);y(`a request to ${t} was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/`);return}return o}function D(t,e,i,s){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};const r=`c${J}`;e.callback=`window._EsriLeafletCallbacks.${r}`,window._EsriLeafletCallbacks[r]=function(n){if(window._EsriLeafletCallbacks[r]!==!0){let l;const u=Object.prototype.toString.call(n);u==="[object Object]"||u==="[object Array]"||(l={error:{code:500,message:"Expected array or object as JSONP response"}},n=null),!l&&n.error&&(l=n,n=null),i.call(s,l,n),window._EsriLeafletCallbacks[r]=!0}};const o=a.DomUtil.create("script",null,document.body);return o.type="text/javascript",o.src=`${t}?${R(e)}`,o.id=r,o.onerror=function(n){if(n&&window._EsriLeafletCallbacks[r]!==!0){const l={error:{code:500,message:"An unknown error occurred"}};i.call(s,l),window._EsriLeafletCallbacks[r]=!0}},a.DomUtil.addClass(o,"esri-leaflet-jsonp"),J++,{id:r,url:o.src,abort(){window._EsriLeafletCallbacks._callback[r]({code:0,message:"Request aborted."})}}}const z=_.cors?j:D;z.CORS=j;z.JSONP=D;function y(...t){console&&console.warn&&console.warn.apply(console,t)}const A={request:Q,get:z,post:ut};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var ht=function(e,i,s,r){var o=(r[0]-s[0])*(e[1]-s[1])-(r[1]-s[1])*(e[0]-s[0]),n=(i[0]-e[0])*(e[1]-s[1])-(i[1]-e[1])*(e[0]-s[0]),l=(r[1]-s[1])*(i[0]-e[0])-(r[0]-s[0])*(i[1]-e[1]);if(l!==0){var u=o/l,h=n/l;if(u>=0&&u<=1&&h>=0&&h<=1)return!0}return!1},ct=function(e,i){for(var s=!1,r=-1,o=e.length,n=o-1;++r<o;n=r)(e[r][1]<=i[1]&&i[1]<e[n][1]||e[n][1]<=i[1]&&i[1]<e[r][1])&&i[0]<(e[n][0]-e[r][0])*(i[1]-e[r][1])/(e[n][1]-e[r][1])+e[r][0]&&(s=!s);return s},pt=function(e,i){for(var s=0;s<e.length;s++)if(e[s]!==i[s])return!1;return!0},V=function(e,i){for(var s=0;s<e.length-1;s++)for(var r=0;r<i.length-1;r++)if(ht(e[s],e[s+1],i[r],i[r+1]))return!0;return!1},G=function(e){return pt(e[0],e[e.length-1])||e.push(e[0]),e},q=function(e){var i=0,s=0,r=e.length,o=e[s],n;for(s;s<r-1;s++)n=e[s+1],i+=(n[0]-o[0])*(n[1]+o[1]),o=n;return i>=0},H=function(e){var i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);return i},dt=function(e,i){var s=V(e,i),r=ct(e,i[0]);return!!(!s&&r)},ft=function(e){for(var i=[],s=[],r,o,n,l=0;l<e.length;l++){var u=G(e[l].slice(0));if(!(u.length<4))if(q(u)){var h=[u.slice().reverse()];i.push(h)}else s.push(u.slice().reverse())}for(var c=[];s.length;){n=s.pop();var d=!1;for(r=i.length-1;r>=0;r--)if(o=i[r][0],dt(o,n)){i[r].push(n),d=!0;break}d||c.push(n)}for(;c.length;){n=c.pop();var v=!1;for(r=i.length-1;r>=0;r--)if(o=i[r][0],V(o,n)){i[r].push(n),v=!0;break}v||i.push([n.reverse()])}return i.length===1?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}},mt=function(e,i){for(var s=i?[i,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<s.length;r++){var o=s[r];if(o in e&&(typeof e[o]=="string"||typeof e[o]=="number"))return e[o]}throw Error("No valid id attribute found")},yt=function t(e,i){var s={};if(e.features){s.type="FeatureCollection",s.features=[];for(var r=0;r<e.features.length;r++)s.features.push(t(e.features[r],i))}if(typeof e.x=="number"&&typeof e.y=="number"&&(s.type="Point",s.coordinates=[e.x,e.y],typeof e.z=="number"&&s.coordinates.push(e.z)),e.points&&(s.type="MultiPoint",s.coordinates=e.points.slice(0)),e.paths&&(e.paths.length===1?(s.type="LineString",s.coordinates=e.paths[0].slice(0)):(s.type="MultiLineString",s.coordinates=e.paths.slice(0))),e.rings&&(s=ft(e.rings.slice(0))),typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"&&(s.type="Polygon",s.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(s.type="Feature",s.geometry=e.geometry?t(e.geometry):null,s.properties=e.attributes?H(e.attributes):null,e.attributes))try{s.id=mt(e.attributes,i)}catch{}return JSON.stringify(s.geometry)===JSON.stringify({})&&(s.geometry=null),e.spatialReference&&e.spatialReference.wkid&&e.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),s},K=function(e){var i=[],s=e.slice(0),r=G(s.shift().slice(0));if(r.length>=4){q(r)||r.reverse(),i.push(r);for(var o=0;o<s.length;o++){var n=G(s[o].slice(0));n.length>=4&&(q(n)&&n.reverse(),i.push(n))}}return i},_t=function(e){for(var i=[],s=0;s<e.length;s++)for(var r=K(e[s]),o=r.length-1;o>=0;o--){var n=r[o].slice(0);i.push(n)}return i},gt=function t(e,i){i=i||"OBJECTID";var s={wkid:4326},r={},o;switch(e.type){case"Point":r.x=e.coordinates[0],r.y=e.coordinates[1],e.coordinates[2]!=null&&(r.z=e.coordinates[2]),r.spatialReference=s;break;case"MultiPoint":r.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"LineString":r.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiLineString":r.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"Polygon":r.rings=K(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiPolygon":r.rings=_t(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"Feature":e.geometry&&(r.geometry=t(e.geometry,i)),r.attributes=e.properties?H(e.properties):{},e.id&&(r.attributes[i]=e.id);break;case"FeatureCollection":for(r=[],o=0;o<e.features.length;o++)r.push(t(e.features[o],i));break;case"GeometryCollection":for(r=[],o=0;o<e.geometries.length;o++)r.push(t(e.geometries[o],i));break}return r};const vt='Powered by <a href="https://www.esri.com">Esri</a>';function b(t,e){return gt(t,e)}function X(t,e){return yt(t,e)}function M(t){if(t.xmin!=="NaN"&&t.ymin!=="NaN"&&t.xmax!=="NaN"&&t.ymax!=="NaN"){const e=a.latLng(t.ymin,t.xmin),i=a.latLng(t.ymax,t.xmax);return a.latLngBounds(e,i)}return null}function Z(t){return t=a.latLngBounds(t),{xmin:t.getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}const Y=/^(OBJECTID|FID|OID|ID)$/i;function tt(t){let e;if(t.objectIdFieldName)e=t.objectIdFieldName;else if(t.fields){for(let i=0;i<=t.fields.length-1;i++)if(t.fields[i].type==="esriFieldTypeOID"){e=t.fields[i].name;break}if(!e){for(let i=0;i<=t.fields.length-1;i++)if(t.fields[i].name.match(Y)){e=t.fields[i].name;break}}}return e}function et(t){for(const e in t.attributes)if(e.match(Y))return e}function x(t,e){let i;const s=t.features||t.results,r=s&&s.length;e?i=e:i=tt(t);const o={type:"FeatureCollection",features:[]};if(r)for(let n=s.length-1;n>=0;n--){const l=X(s[n],i||et(s[n]));o.features.push(l)}return o}function P(t){return t=a.Util.trim(t),t[t.length-1]!=="/"&&(t+="/"),t}function g(t){if(t.url.indexOf("?")!==-1){t.requestParams=t.requestParams||{};const e=t.url.substring(t.url.indexOf("?")+1);t.url=t.url.split("?")[0],t.requestParams=JSON.parse(`{"${decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')}"}`)}return t.url=P(t.url.split("?")[0]),t}function it(t){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(t)}function U(t){let e;switch(t){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":e="esriGeometryPolyline";break;case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":e="esriGeometryPolygon";break;case"MultiPolygon":e="esriGeometryPolygon";break}return e}function T(t){return`${t.getSize().x-lt.attributionWidthOffset}px`}function S(t){if(t.attributionControl){if(t.attributionControl._esriAttributionLayerCount||(t.attributionControl._esriAttributionLayerCount=0),t.attributionControl._esriAttributionLayerCount===0){if(!t.attributionControl._esriAttributionAddedOnce){const e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(e);const i=document.createElement("style");i.type="text/css",i.innerHTML=`.esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: ${T(t)};}`,document.getElementsByTagName("head")[0].appendChild(i),t.on("resize",s=>{t.attributionControl&&(t.attributionControl._container.style.maxWidth=T(s.target))}),t.attributionControl._esriAttributionAddedOnce=!0}a.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution:hover"),a.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution")}t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount+1}}function st(){return vt}function L(t){t.attributionControl&&(t.attributionControl._esriAttributionLayerCount&&t.attributionControl._esriAttributionLayerCount===1&&(a.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution:hover"),a.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution")),t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount-1)}function N(t){const e={geometry:null,geometryType:null};if(t instanceof a.LatLngBounds)return e.geometry=Z(t),e.geometryType="esriGeometryEnvelope",e;if(t.getLatLng&&(t=t.getLatLng()),t instanceof a.LatLng&&(t={type:"Point",coordinates:[t.lng,t.lat]}),t instanceof a.GeoJSON&&(t=t.getLayers()[0].feature.geometry,e.geometry=b(t),e.geometryType=U(t.type)),t.toGeoJSON&&(t=t.toGeoJSON()),t.type==="Feature"&&(t=t.geometry),t.type==="Point"||t.type==="LineString"||t.type==="Polygon"||t.type==="MultiPolygon")return e.geometry=b(t),e.geometryType=U(t.type),e;y("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function rt(t,e){_.cors&&Q(t,{},a.Util.bind((i,s)=>{if(i)return;e._esriAttributions=[];for(let o=0;o<s.contributors.length;o++){const n=s.contributors[o];for(let l=0;l<n.coverageAreas.length;l++){const u=n.coverageAreas[l],h=a.latLng(u.bbox[0],u.bbox[1]),c=a.latLng(u.bbox[2],u.bbox[3]);e._esriAttributions.push({attribution:n.attribution,score:u.score,bounds:a.latLngBounds(h,c),minZoom:u.zoomMin,maxZoom:u.zoomMax})}}e._esriAttributions.sort((o,n)=>n.score-o.score),C({target:e})},this))}function C(t){const e=t.target,i=e._esriAttributions;if(!e||!e.attributionControl)return;const s=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(s&&i){let r="";const o=e.getBounds(),n=a.latLngBounds(o.getSouthWest().wrap(),o.getNorthEast().wrap()),l=e.getZoom();for(let u=0;u<i.length;u++){const h=i[u],c=h.attribution;!r.match(c)&&h.bounds.intersects(n)&&l>=h.minZoom&&l<=h.maxZoom&&(r+=`, ${c}`)}r=`${st()} | ${r.substr(2)}`,s.innerHTML=r,s.style.maxWidth=T(e),e.fire("attributionupdated",{attribution:r})}}const Ut={warn:y,cleanUrl:P,getUrlParams:g,isArcgisOnline:it,geojsonTypeToArcGIS:U,responseToFeatureCollection:x,geojsonToArcGIS:b,arcgisToGeoJSON:X,boundsToExtent:Z,extentToBounds:M,calcAttributionWidth:T,setEsriAttribution:S,getEsriAttributionHtmlString:st,removeEsriAttribution:L,_setGeometry:N,_getAttributionData:rt,_updateMapAttribution:C,_findIdAttributeFromFeature:et,_findIdAttributeFromResponse:tt},O=a.Class.extend({options:{proxy:!1,useCors:w},generateSetter(t,e){return a.Util.bind(function(i){return this.params[t]=i,this},e)},initialize(t){if(t.request&&t.options?(this._service=t,a.Util.setOptions(this,t.options)):(a.Util.setOptions(this,t),this.options.url=P(t.url)),this.params=a.Util.extend({},this.params||{}),this.setters)for(const e in this.setters){const i=this.setters[e];this[e]=this.generateSetter(i,this)}},token(t){return this._service?this._service.authenticate(t):this.params.token=t,this},apikey(t){return this.token(t)},format(t){return this.params.returnUnformattedValues=!t,this},request(t,e){return this.options.requestParams&&a.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,t,e):this._request("request",this.path,this.params,t,e)},_request(t,e,i,s,r){const o=this.options.proxy?`${this.options.proxy}?${this.options.url}${e}`:this.options.url+e;return(t==="get"||t==="request")&&!this.options.useCors?A.get.JSONP(o,i,s,r):A[t](o,i,s,r)}});function kt(t){return t=g(t),new O(t)}const bt=O.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelContains",this},intersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIntersects",this},contains(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelWithin",this},crosses(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelCrosses",this},touches(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelTouches",this},overlaps(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby(t,e){return t=a.latLng(t),this.params.geometry=[t.lng,t.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSR=4326,this},where(t){return this.params.where=t,this},between(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},orderBy(t,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?`${this.params.orderByFields},`:"",this.params.orderByFields+=[t,e].join(" "),this},run(t,e){return this._cleanParams(),this.options.isModern||it(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(i,s){this._trapSQLerrors(i),t.call(e,i,s,s)},this)):this.request(function(i,s){this._trapSQLerrors(i),t.call(e,i,s&&x(s),s)},this)},count(t,e){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(i,s){t.call(this,i,s&&s.count,s)},e)},ids(t,e){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(i,s){t.call(this,i,s&&s.objectIds,s)},e)},bounds(t,e){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request((i,s)=>{s&&s.extent&&M(s.extent)?t.call(e,i,M(s.extent),s):(i={message:"Invalid Bounds"},t.call(e,i,null,s))},e)},distinct(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize(t){const e=a.point(t);return this.params.pixelSize=[e.x,e.y],this},layer(t){return this.path=`${t}/query`,this},_trapSQLerrors(t){t&&t.code==="400"&&y("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams(t){this.params.inSR=4326;const e=N(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function $(t){return new bt(t)}const xt=O.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs(t,e){return this.params.layerDefs=this.params.layerDefs?`${this.params.layerDefs};`:"",this.params.layerDefs+=[t,e].join(":"),this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run(t,e){return this.request((i,s)=>{t.call(e,i,s&&x(s),s)},e)}});function St(t){return new xt(t)}const W=O.extend({path:"identify",between(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this}});function Bt(t){return new W(t)}const Lt=W.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on(t){const e=Z(t.getBounds()),i=t.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at(t){return t.length===2&&(t=a.latLng(t)),this._setGeometryParams(t),this},layerDef(t,e){return this.params.layerDefs=this.params.layerDefs?`${this.params.layerDefs};`:"",this.params.layerDefs+=[t,e].join(":"),this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run(t,e){return this.request((i,s)=>{if(i)t.call(e,i,void 0,s);else{const r=x(s);s.results=s.results.reverse();for(let o=0;o<r.features.length;o++){const n=r.features[o];n.layerId=s.results[o].layerId}t.call(e,void 0,r,s)}})},_setGeometryParams(t){const e=N(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function It(t){return new Lt(t)}const At=W.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at(t){return t=a.latLng(t),this.params.geometry=JSON.stringify({x:t.lng,y:t.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule(){return this.params.mosaicRule},getRenderingRule(){return this.params.renderingRule},getPixelSize(){return this.params.pixelSize},run(t,e){return this.request(function(i,s){t.call(e,i,s&&this._responseToGeoJSON(s),s)},this)},_responseToGeoJSON(t){const e=t.location,i=t.catalogItems,s=t.catalogItemVisibilities,r={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:t.objectId,name:t.name,value:t.value},id:t.objectId}};if(t.properties&&t.properties.Values&&(r.pixel.properties.values=t.properties.Values),i&&i.features&&(r.catalogItems=x(i),s&&s.length===r.catalogItems.features.length))for(let o=s.length-1;o>=0;o--)r.catalogItems.features[o].properties.catalogItemVisibility=s[o];return r}});function Tt(t){return new At(t)}const F=a.Evented.extend({options:{proxy:!1,useCors:w,timeout:0},initialize(t){t=t||{},this._requestQueue=[],this._authenticating=!1,a.Util.setOptions(this,t),this.options.url=P(this.options.url)},get(t,e,i,s){return this._request("get",t,e,i,s)},post(t,e,i,s){return this._request("post",t,e,i,s)},request(t,e,i,s){return this._request("request",t,e,i,s)},metadata(t,e){return this._request("get","",{},t,e)},authenticate(t){return this._authenticating=!1,this.options.token=t,this._runQueue(),this},getTimeout(){return this.options.timeout},setTimeout(t){this.options.timeout=t},_request(t,e,i,s,r){this.fire("requeststart",{url:this.options.url+e,params:i,method:t},!0);const o=this._createServiceCallback(t,e,i,s,r);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&a.Util.extend(i,this.options.requestParams),this._authenticating)this._requestQueue.push([t,e,i,s,r]);else{const n=this.options.proxy?`${this.options.proxy}?${this.options.url}${e}`:this.options.url+e;return(t==="get"||t==="request")&&!this.options.useCors?A.get.JSONP(n,i,o,r):A[t](n,i,o,r)}},_createServiceCallback(t,e,i,s,r){return a.Util.bind(function(o,n){o&&(o.code===499||o.code===498)&&(this._authenticating=!0,this._requestQueue.push([t,e,i,s,r]),this.fire("authenticationrequired",{authenticate:a.Util.bind(this.authenticate,this)},!0),o.authenticate=a.Util.bind(this.authenticate,this)),s.call(r,o,n),o?this.fire("requesterror",{url:this.options.url+e,params:i,message:o.message,code:o.code,method:t},!0):this.fire("requestsuccess",{url:this.options.url+e,params:i,response:n,method:t},!0),this.fire("requestend",{url:this.options.url+e,params:i,method:t},!0)},this)},_runQueue(){for(let t=this._requestQueue.length-1;t>=0;t--){const e=this._requestQueue[t],i=e.shift();this[i].apply(this,e)}this._requestQueue=[]}});function Dt(t){return t=g(t),new F(t)}const Ct=F.extend({identify(){return It(this)},find(){return St(this)},query(){return $(this)}});function ot(t){return new Ct(t)}const wt=F.extend({query(){return $(this)},identify(){return Tt(this)}});function Rt(t){return new wt(t)}const Pt=F.extend({options:{idAttribute:"OBJECTID"},query(){return $(this)},addFeature(t,e,i){this.addFeatures(t,e,i)},addFeatures(t,e,i){const s=t.features?t.features:[t];for(let r=s.length-1;r>=0;r--)delete s[r].id;return t=b(t),t=s.length>1?t:[t],this.post("addFeatures",{features:t},(r,o)=>{const n=o&&o.addResults?o.addResults.length>1?o.addResults:o.addResults[0]:void 0;e&&e.call(i,r||o.addResults[0].error,n)},i)},updateFeature(t,e,i){this.updateFeatures(t,e,i)},updateFeatures(t,e,i){const s=t.features?t.features:[t];return t=b(t,this.options.idAttribute),t=s.length>1?t:[t],this.post("updateFeatures",{features:t},(r,o)=>{const n=o&&o.updateResults?o.updateResults.length>1?o.updateResults:o.updateResults[0]:void 0;e&&e.call(i,r||o.updateResults[0].error,n)},i)},deleteFeature(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures(t,e,i){return this.post("deleteFeatures",{objectIds:t},(s,r)=>{const o=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;e&&e.call(i,s||r.deleteResults[0].error,o)},i)}});function Ot(t){return new Pt(t)}const p=window.location.protocol!=="https:"?"http:":"https:",k=a.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:`${p}//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:m?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:`${p}//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:`${p}//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:`${p}//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:`${p}//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize(t,e){let i;if(typeof t=="object"&&t.urlTemplate&&t.options)i=t;else if(typeof t=="string"&&k.TILES[t])i=k.TILES[t];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');const s=a.Util.extend(i.options,e);a.Util.setOptions(this,s),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&i.urlTemplate.indexOf("token=")===-1&&(i.urlTemplate+=`?token=${this.options.token}`),this.options.proxy&&(i.urlTemplate=`${this.options.proxy}?${i.urlTemplate}`),a.TileLayer.prototype.initialize.call(this,i.urlTemplate,s)},onAdd(t){S(t),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&rt((this.options.proxy?`${this.options.proxy}?`:"")+this.options.attributionUrl,t),t.on("moveend",C),a.TileLayer.prototype.onAdd.call(this,t)},onRemove(t){L(t),t.off("moveend",C),a.TileLayer.prototype.onRemove.call(this,t)},_initPane(){if(!this._map.getPane(this.options.pane)){const t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution(){let t;return this.options.attribution&&(t=`<span class="esri-dynamic-attribution">${this.options.attribution}</span>`),t}});function zt(t,e){return new k(t,e)}const nt=a.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize(t){t=a.Util.setOptions(this,t),t.apikey&&(t.token=t.apikey),t=g(t),this.tileUrl=`${(t.proxy?`${t.proxy}?`:"")+t.url}tile/{z}/{y}/{x}${t.requestParams&&Object.keys(t.requestParams).length>0?a.Util.getParamString(t.requestParams):""}`,t.url.indexOf("{s}")!==-1&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=ot(t),this.service.addEventParent(this),new RegExp(/tiles.arcgis(online)?\.com/g).test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+=`?token=${this.options.token}`),a.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl(t){const e=this._getZoomForUrl();return a.Util.template(this.tileUrl,a.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&this._lodMap[e]!==void 0?this._lodMap[e]:e},this.options))},createTile(t,e){const i=document.createElement("img");return a.DomEvent.on(i,"load",a.Util.bind(this._tileOnLoad,this,e,i)),a.DomEvent.on(i,"error",a.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",this._lodMap&&this._lodMap[this._getZoomForUrl()]!==void 0?i.src=this.getTileUrl(t):this.once("lodmap",function(){i.src=this.getTileUrl(t)},this),i},onAdd(t){S(t),this._lodMap||this.metadata(function(e,i){if(!e&&i.spatialReference){const s=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution())),t.options.crs===a.CRS.EPSG3857&&(s===102100||s===3857)){this._lodMap={};const r=i.tileInfo.lods,o=nt.MercatorZoomLevels;for(let n=0;n<r.length;n++){const l=r[n];for(const u in o){const h=o[u];if(this._withinPercentage(l.resolution,h,this.options.zoomOffsetAllowance)){this._lodMap[u]=l.level;break}}}this.fire("lodmap")}else t.options.crs&&t.options.crs.code&&t.options.crs.code.indexOf(s)>-1||y("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),a.TileLayer.prototype.onAdd.call(this,t)},onRemove(t){L(t),a.TileLayer.prototype.onRemove.call(this,t)},metadata(t,e){return this.service.metadata(t,e),this},identify(){return this.service.identify()},find(){return this.service.find()},query(){return this.service.query()},authenticate(t){const e=`?token=${t}`;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage(t,e,i){return Math.abs(t/e-1)<i}});function Zt(t,e){return new nt(t,e)}const Ft=a.ImageOverlay.extend({onAdd(t){this._topLeft=t.getPixelBounds().min,a.ImageOverlay.prototype.onAdd.call(this,t)},_reset(){this._map.options.crs===a.CRS.EPSG3857?a.ImageOverlay.prototype._reset.call(this):a.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),at=a.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:w,attribution:null,interactive:!1,alt:""},onAdd(t){S(t),this.options.zIndex&&(this.options.position=null),this._update=a.Util.throttle(this._update,this.options.updateInterval,this),t.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(e,i){!e&&!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove(t){L(t),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup(t,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=a.popup(e),this._popupFunction=t,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},_setAutoZIndex(t){if(!this._currentImage)return;const e=this._currentImage.getPane().children;let i=-t(-1/0,1/0);for(let s=0,r=e.length,o;s<r;s++)o=e[s].style.zIndex,e[s]!==this._currentImage._image&&o&&(i=t(i,+o));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this.setZIndex(this.options.zIndex))},getAttribution(){return this.options.attribution},getOpacity(){return this.options.opacity},setOpacity(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getTimeRange(){return[this.options.from,this.options.to]},setTimeRange(t,e){return this.options.from=t,this.options.to=e,this._update(),this},metadata(t,e){return this.service.metadata(t,e),this},authenticate(t){return this.service.authenticate(t),this},redraw(){this._update()},_renderImage(t,e,i){if(this._map){if(i&&(t=`data:${i};base64,${t}`),!t)return;const s=new Ft(t,e,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map);let r;const o=function(){this._map.removeLayer(s),this.fire("error"),s.off("load",r,this)};r=function(n){if(s.off("error",o,this),this._map){const l=n.target,u=this._currentImage;l._bounds.equals(e)&&l._bounds.equals(this._map.getBounds())?(this._currentImage=l,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),u&&this._map&&this._map.removeLayer(u),u&&u._map&&u._map.removeLayer(u)):this._map.removeLayer(l)}this.fire("load",{bounds:e})},s.once("error",o,this),s.once("load",r,this)}},_update(){if(!this._map)return;const t=this._map.getZoom(),e=this._map.getBounds();if(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress)return;if(t>this.options.maxZoom||t<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}const i=this._buildExportParams();a.Util.extend(i,this.options.requestParams),i?(this._requestExport(i,e),this.fire("loading",{bounds:e})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)},_renderPopup(t,e,i,s){if(t=a.latLng(t),this._shouldRenderPopup&&this._lastClick.equals(t)){const r=this._popupFunction(e,i,s);r&&this._popup.setLatLng(t).setContent(r).openOn(this._map)}},_resetPopupState(t){this._shouldRenderPopup=!1,this._lastClick=t.latlng},_calculateBbox(){const t=this._map.getPixelBounds(),e=this._map.unproject(t.getBottomLeft()),i=this._map.unproject(t.getTopRight()),s=this._map.options.crs.project(i),r=this._map.options.crs.project(e),o=a.bounds(s,r);return[o.getBottomLeft().x,o.getBottomLeft().y,o.getTopRight().x,o.getTopRight().y].join(",")},_calculateImageSize(){const t=this._map.getPixelBounds(),e=this._map.getSize(),i=this._map.unproject(t.getBottomLeft()),s=this._map.unproject(t.getTopRight()),r=this._map.latLngToLayerPoint(s).y,o=this._map.latLngToLayerPoint(i).y;return(r>0||o<e.y)&&(e.y=o-r),`${e.x},${e.y}`}}),Et=at.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query(){return this.service.query()},identify(){return this.service.identify()},initialize(t){t=g(t),this.service=Rt(t),this.service.addEventParent(this),a.Util.setOptions(this,t)},setPixelType(t){return this.options.pixelType=t,this._update(),this},getPixelType(){return this.options.pixelType},setBandIds(t){return a.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds(){return this.options.bandIds},setNoData(t,e){return a.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData(){return this.options.noData},getNoDataInterpretation(){return this.options.noDataInterpretation},setRenderingRule(t){this.options.renderingRule=t,this._update()},getRenderingRule(){return this.options.renderingRule},setMosaicRule(t){this.options.mosaicRule=t,this._update()},getMosaicRule(){return this.options.mosaicRule},_getPopupData(t){const e=a.Util.bind(function(s,r,o){s||setTimeout(a.Util.bind(function(){this._renderPopup(t.latlng,s,r,o)},this),300)},this),i=this.identify().at(t.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams(){const t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=`${this.options.from.valueOf()},${this.options.to.valueOf()}`),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport(t,e){if(this.options.f==="json")this.service.request("exportImage",t,function(i,s){i||(this.options.token&&(s.href+=`?token=${this.options.token}`),this.options.proxy&&(s.href=`${this.options.proxy}?${s.href}`),this._renderImage(s.href,e))},this);else{t.f="image";let i=`${this.options.url}exportImage${a.Util.getParamString(t)}`;this.options.proxy&&(i=`${this.options.proxy}?${i}`),this._renderImage(i,e)}}});function Nt(t,e){return new Et(t,e)}const Gt=at.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize(t){t=g(t),this.service=ot(t),this.service.addEventParent(this),a.Util.setOptions(this,t)},getDynamicLayers(){return this.options.dynamicLayers},setDynamicLayers(t){return this.options.dynamicLayers=t,this._update(),this},getLayers(){return this.options.layers},setLayers(t){return this.options.layers=t,this._update(),this},getLayerDefs(){return this.options.layerDefs},setLayerDefs(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions(){return this.options.timeOptions},setTimeOptions(t){return this.options.timeOptions=t,this._update(),this},query(){return this.service.query()},identify(){return this.service.identify()},find(){return this.service.find()},_getPopupData(t){const e=a.Util.bind(function(s,r,o){s||setTimeout(a.Util.bind(function(){this._renderPopup(t.latlng,s,r,o)},this),300)},this);let i;if(this.options.popup?i=this.options.popup.on(this._map).at(t.latlng):i=this.identify().on(this._map).at(t.latlng),i.params.maxAllowableOffset||i.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?i.layers(`visible:${this.options.layers.join(",")}`):i.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!i.params.layerDefs)for(const s in this.options.layerDefs)Object.hasOwn(this.options.layerDefs,s)&&i.layerDef(s,this.options.layerDefs[s]);i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams(){const t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;e.layers=`show:${this.options.layers.join(",")}`}return this.options.layerDefs&&(e.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=`${this.options.from.valueOf()},${this.options.to.valueOf()}`),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport(t,e){if(this.options.f==="json")this.service.request("export",t,function(i,s){i||(this.options.token&&s.href&&(s.href+=`?token=${this.options.token}`),this.options.proxy&&s.href&&(s.href=`${this.options.proxy}?${s.href}`),s.href?this._renderImage(s.href,e):this._renderImage(s.imageData,e,s.contentType))},this);else{t.f="image";let i=`${this.options.url}export${a.Util.getParamString(t)}`;this.options.proxy&&(i=`${this.options.proxy}?${i}`),this._renderImage(i,e)}}});function $t(t,e){return new Gt(t,e)}const I=a.Layer.extend({options:{cellSize:512,updateWhenIdle:a.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize(t){a.Util.setOptions(this,t)},onAdd(){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove(){this._removeAllCells(),this._cellZoom=void 0},isLoading(){return this._loading},redraw(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents(){const t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),t},createCell(){return document.createElement("div")},removeCell(){},reuseCell(){},cellLeave(){},cellEnter(){},getCellSize(){const t=this.options.cellSize;return t instanceof a.Point?t:new a.Point(t,t)},_pruneCells(){if(!this._map)return;let t,e;for(t in this._cells)e=this._cells[t],e.retain=e.current;for(t in this._cells)if(e=this._cells[t],e.current&&!e.active){const i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._cells)this._cells[t].retain||this._removeCell(t)},_removeAllCells(){for(const t in this._cells)this._removeCell(t)},_invalidateAll(){this._removeAllCells(),this._cellZoom=void 0},_retainParent(t,e,i,s){const r=Math.floor(t/2),o=Math.floor(e/2),n=i-1,l=new a.Point(+r,+o);l.z=+n;const u=this._cellCoordsToKey(l),h=this._cells[u];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),n>s?this._retainParent(r,o,n,s):!1)},_retainChildren(t,e,i,s){for(let r=2*t;r<2*t+2;r++)for(let o=2*e;o<2*e+2;o++){const n=new a.Point(r,o);n.z=i+1;const l=this._cellCoordsToKey(n),u=this._cells[l];if(u&&u.active){u.retain=!0;continue}else u&&u.loaded&&(u.retain=!0);i+1<s&&this._retainChildren(r,o,i+1,s)}},_resetView(t){const e=t&&(t.pinch||t.flyTo);e||this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_setView(t,e,i,s){const r=Math.round(e);s||(this._cellZoom=r,this._abortLoading&&this._abortLoading(),this._resetGrid(),r!==void 0&&this._update(t),i||this._pruneCells(),this._noPrune=!!i)},_resetGrid(){const t=this._map,e=t.options.crs,i=this._cellSize=this.getCellSize(),s=this._cellZoom,r=this._map.getPixelWorldBounds(this._cellZoom);r&&(this._globalCellRange=this._pxBoundsToCellRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],s).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],s).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],s).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],s).y/i.y)]},_onMoveEnd(t){t&&(t.pinch||t.flyTo)||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds(t){const e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),s=e.getZoomScale(i,this._cellZoom),r=e.project(t,this._cellZoom).floor(),o=e.getSize().divideBy(s*2);return new a.Bounds(r.subtract(o),r.add(o))},_update(t){const e=this._map;if(!e)return;const i=Math.round(e.getZoom());t===void 0&&(t=e.getCenter());const s=this._getCelldPixelBounds(t),r=this._pxBoundsToCellRange(s),o=r.getCenter(),n=[],l=this.options.keepBuffer,u=new a.Bounds(r.getBottomLeft().subtract([l,-l]),r.getTopRight().add([l,-l]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of cells");for(const h in this._cells){const c=this._cells[h].coords;(c.z!==this._cellZoom||!u.contains(new a.Point(c.x,c.y)))&&(this._cells[h].current=!1)}if(Math.abs(i-this._cellZoom)>1){this._setView(t,i);return}for(let h=r.min.y;h<=r.max.y;h++)for(let c=r.min.x;c<=r.max.x;c++){const d=new a.Point(c,h);if(d.z=this._cellZoom,!this._isValidCell(d))continue;const v=this._cells[this._cellCoordsToKey(d)];v?v.current=!0:n.push(d)}if(n.sort((h,c)=>h.distanceTo(o)-c.distanceTo(o)),n.length!==0){this._loading||(this._loading=!0);for(let h=0;h<n.length;h++){const c=this._cellCoordsToKey(n[h]),d=this._keyToCellCoords(c);this._activeCells[d]?this._reuseCell(n[h]):this._createCell(n[h])}}},_isValidCell(t){const e=this._map.options.crs;if(!e.infinite){const s=this._globalCellRange;if(!e.wrapLng&&(t.x<s.min.x||t.x>s.max.x)||!e.wrapLat&&(t.y<s.min.y||t.y>s.max.y))return!1}if(!this.options.bounds)return!0;const i=this._cellCoordsToBounds(t);return a.latLngBounds(this.options.bounds).overlaps(i)},_keyToBounds(t){return this._cellCoordsToBounds(this._keyToCellCoords(t))},_cellCoordsToNwSe(t){const e=this._map,i=this.getCellSize(),s=t.scaleBy(i),r=s.add(i),o=e.unproject(s,t.z),n=e.unproject(r,t.z);return[o,n]},_cellCoordsToBounds(t){const e=this._cellCoordsToNwSe(t);let i=new a.LatLngBounds(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_cellCoordsToKey(t){return`${t.x}:${t.y}:${t.z}`},_keyToCellCoords(t){const e=t.split(":"),i=new a.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeCell(t){const e=this._cells[t];if(!e)return;const i=this._keyToCellCoords(t),s=this._wrapCoords(i),r=this._cellCoordsToBounds(this._wrapCoords(i));e.current=!1,delete this._cells[t],this._activeCells[t]=e,this.cellLeave(r,s,t),this.fire("cellleave",{key:t,coords:s,bounds:r})},_reuseCell(t){const e=this._cellCoordsToKey(t);this._cells[e]=this._activeCells[e],this._cells[e].current=!0;const i=this._wrapCoords(t),s=this._cellCoordsToBounds(this._wrapCoords(t));this.cellEnter(s,i,e),this.fire("cellenter",{key:e,coords:i,bounds:s})},_createCell(t){const e=this._cellCoordsToKey(t),i=this._wrapCoords(t),s=this._cellCoordsToBounds(this._wrapCoords(t));this.createCell(s,i,e),this.fire("cellcreate",{key:e,coords:i,bounds:s}),this._cells[e]={coords:t,current:!0},a.Util.requestAnimFrame(this._pruneCells,this)},_cellReady(t,e,i){const s=this._cellCoordsToKey(t);i=this._cells[s],i&&(i.loaded=+new Date,i.active=!0)},_getCellPos(t){return t.scaleBy(this.getCellSize())},_wrapCoords(t){const e=new a.Point(this._wrapX?a.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?a.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToCellRange(t){const e=this.getCellSize();return new a.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))}});function f(t){this.values=[].concat(t||[])}f.prototype.query=function(t){var e=this.getIndex(t);return this.values[e]};f.prototype.getIndex=function(e){this.dirty&&this.sort();for(var i=0,s=this.values.length-1,r,o;i<=s;)if(r=(i+s)/2|0,o=this.values[Math.round(r)],+o.value<+e)i=r+1;else if(+o.value>+e)s=r-1;else return r;return Math.abs(~s)};f.prototype.between=function(e,i){var s=this.getIndex(e),r=this.getIndex(i);if(s===0&&r===0)return[];for(;this.values[s-1]&&this.values[s-1].value===e;)s--;for(;this.values[r+1]&&this.values[r+1].value===i;)r++;return this.values[r]&&this.values[r].value===i&&this.values[r+1]&&r++,this.values.slice(s,r)};f.prototype.insert=function(e){return this.values.splice(this.getIndex(e.value),0,e),this};f.prototype.bulkAdd=function(e,i){return this.values=this.values.concat([].concat(e||[])),i?this.sort():this.dirty=!0,this};f.prototype.sort=function(){return this.values.sort(function(e,i){return+i.value-+e.value}).reverse(),this.dirty=!1,this};const E=I.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize(t){if(I.prototype.initialize.call(this,t),t=g(t),t=a.Util.setOptions(this,t),this.service=Ot(t),this.service.addEventParent(this),this.options.fields[0]!=="*"){let e=!1;for(let i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);e===!1&&y("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new f,this._endTimeIndex=new f):this.options.timeField&&(this._timeIndex=new f),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd(t){return S(t),this.service.metadata(function(e,i){if(!e){const s=i.supportedQueryFormats;let r=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(r=!0),!r&&s&&s.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),i.objectIdField&&(this.service.options.idAttribute=i.objectIdField),!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}},this),t.on("zoomend",this._handleZoomChange,this),I.prototype.onAdd.call(this,t)},onRemove(t){return L(t),t.off("zoomend",this._handleZoomChange,this),I.prototype.onRemove.call(this,t)},getAttribution(){return this.options.attribution},createCell(t,e){this._visibleZoom()&&this._requestFeatures(t,e)},_requestFeatures(t,e,i,s){this._activeRequests++,s=s||0;const r=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:t},!0),this._buildQuery(t,s).run(function(o,n,l){l&&l.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===r&&(!o&&n&&n.features.length&&a.Util.requestAnimFrame(a.Util.bind(function(){this._addFeatures(n.features,e),this._postProcessFeatures(t)},this)),!o&&n&&!n.features.length&&this._postProcessFeatures(t),o&&this._postProcessFeatures(t),i&&i.call(this,o,n),l&&(l.exceededTransferLimit||l.properties&&l.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(t,e,i,s+n.features.length))},this)},_postProcessFeatures(t){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:t})},_cacheKey(t){return`${t.z}:${t.x}:${t.y}`},_addFeatures(t,e){let i;e&&(i=this._cacheKey(e),this._cache[i]=this._cache[i]||[]);for(let s=t.length-1;s>=0;s--){const r=t[s].id;this._currentSnapshot.indexOf(r)===-1&&this._currentSnapshot.push(r),typeof i<"u"&&this._cache[i].indexOf(r)===-1&&this._cache[i].push(r)}this.options.timeField&&this._buildTimeIndexes(t),this.createLayers(t)},_buildQuery(t,e){let i=this.service.query().intersects(t).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(e))&&(i=i.offset(e)),i.params.resultType="tile",this.options.requestParams&&a.Util.extend(i.params,this.options.requestParams),this.options.simplifyFactor&&i.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&i.between(this.options.from,this.options.to),i},setWhere(t,e,i){this.options.where=t&&t.length?t:"1=1";const s=[],r=[];let o=0,n=null;const l=a.Util.bind(function(u,h){if(u&&(n=u),h)for(let c=h.features.length-1;c>=0;c--)r.push(h.features[c].id);o--,o<=0&&this._visibleZoom()&&t===this.options.where&&(this._currentSnapshot=r,a.Util.requestAnimFrame(a.Util.bind(function(){this.removeLayers(s),this.addLayers(r),e&&e.call(i,n)},this)))},this);for(let u=this._currentSnapshot.length-1;u>=0;u--)s.push(this._currentSnapshot[u]);this._cache={};for(const u in this._cells){o++;const h=this._keyToCellCoords(u),c=this._cellCoordsToBounds(h);this._requestFeatures(c,h,l)}return this},getWhere(){return this.options.where},getTimeRange(){return[this.options.from,this.options.to]},setTimeRange(t,e,i,s){const r=this.options.from,o=this.options.to;let n=0,l=null;const u=a.Util.bind(function(h){h&&(l=h),this._filterExistingFeatures(r,o,t,e),n--,i&&n<=0&&i.call(s,l)},this);if(this.options.from=t,this.options.to=e,this._filterExistingFeatures(r,o,t,e),this.options.timeFilterMode==="server")for(const h in this._cells){n++;const c=this._keyToCellCoords(h),d=this._cellCoordsToBounds(c);this._requestFeatures(d,c,u)}return this},refresh(){this.setWhere(this.options.where)},_filterExistingFeatures(t,e,i,s){const r=t&&e?this._getFeaturesInTimeRange(t,e):this._currentSnapshot,o=this._getFeaturesInTimeRange(i,s);if(o.indexOf)for(let n=0;n<o.length;n++){const l=r.indexOf(o[n]);l>=0&&r.splice(l,1)}a.Util.requestAnimFrame(a.Util.bind(function(){this.removeLayers(r),this.addLayers(o)},this))},_getFeaturesInTimeRange(t,e){const i=[];let s;if(this.options.timeField.start&&this.options.timeField.end){const r=this._startTimeIndex.between(t,e),o=this._endTimeIndex.between(t,e);s=r.concat(o)}else if(this._timeIndex)s=this._timeIndex.between(t,e);else return y("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(let r=s.length-1;r>=0;r--)i.push(s[r].id);return i},_buildTimeIndexes(t){let e,i;if(this.options.timeField.start&&this.options.timeField.end){const s=[],r=[];for(e=t.length-1;e>=0;e--)i=t[e],s.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),r.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(s),this._endTimeIndex.bulkAdd(r)}else{const s=[];for(e=t.length-1;e>=0;e--)i=t[e],s.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(s)}},_featureWithinTimeRange(t){if(!this.options.from||!this.options.to)return!0;const e=+this.options.from.valueOf(),i=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){const s=+t.properties[this.options.timeField];return s>=e&&s<=i}if(this.options.timeField.start&&this.options.timeField.end){const s=+t.properties[this.options.timeField.start],r=+t.properties[this.options.timeField.end];return s>=e&&s<=i||r>=e&&r<=i||s<=e&&r>=i}},_visibleZoom(){if(!this._map)return!1;const t=this._map.getZoom();return!(t>this.options.maxZoom||t<this.options.minZoom)},_handleZoomChange(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(const t in this._cells){const e=this._cells[t].coords,i=this._cacheKey(e);this._cache[i]&&this.addLayers(this._cache[i])}},authenticate(t){return this.service.authenticate(t),this},metadata(t,e){return this.service.metadata(t,e),this},query(){return this.service.query()},_getMetadata(t){this._metadata?t(void 0,this._metadata):this.metadata(a.Util.bind(function(e,i){this._metadata=i,t(e,this._metadata)},this))},addFeature(t,e,i){this.addFeatures(t,e,i)},addFeatures(t,e,i){this._getMetadata(a.Util.bind(function(s,r){if(s){e&&e.call(this,s,null);return}const o=t.features?t.features:[t];this.service.addFeatures(t,a.Util.bind(function(n,l){if(!n){for(let u=o.length-1;u>=0;u--)o[u].properties[r.objectIdField]=o.length>1?l[u].objectId:l.objectId,o[u].id=o.length>1?l[u].objectId:l.objectId;this._addFeatures(o)}e&&e.call(i,n,l)},this))},this))},updateFeature(t,e,i){this.updateFeatures(t,e,i)},updateFeatures(t,e,i){const s=t.features?t.features:[t];this.service.updateFeatures(t,function(r,o){if(!r){for(let n=s.length-1;n>=0;n--)this.removeLayers([s[n].id],!0);this._addFeatures(s)}e&&e.call(i,r,o)},this)},deleteFeature(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures(t,e,i){return this.service.deleteFeatures(t,function(s,r){const o=r.length?r:[r];if(!s&&o.length>0)for(let n=o.length-1;n>=0;n--)this.removeLayers([o[n].objectId],!0);e&&e.call(i,s,r)},this)}}),qt=E.extend({options:{cacheLayers:!0},initialize(t){t.apikey&&(t.token=t.apikey),E.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove(t){for(const e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return E.prototype.onRemove.call(this,t)},createNewLayer(t){const e=a.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer(t,e){let i=[];const s=this.options.coordsToLatLng||a.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=a.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,s),t.setLatLngs(i);break;case"MultiLineString":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,s),t.setLatLngs(i);break;case"Polygon":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,s),t.setLatLngs(i);break;case"MultiPolygon":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,s),t.setLatLngs(i);break}this.redraw(t.feature.id)},createLayers(t){for(let e=t.length-1;e>=0;e--){const i=t[e],s=this._layers[i.id];let r;this._visibleZoom()&&s&&!this._map.hasLayer(s)&&(!this.options.timeField||this._featureWithinTimeRange(i))&&(this._map.addLayer(s),this.fire("addfeature",{feature:s.feature},!0)),s&&(s.setLatLngs||s.setLatLng)&&this._updateLayer(s,i),s||(r=this.createNewLayer(i),r?(r.feature=i,r.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(r.feature,r),this._layers[r.feature.id]=r,this.setFeatureStyle(r.feature.id,this.options.style),this.fire("createfeature",{feature:r.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(i))&&this._map.addLayer(r)):y("invalid GeoJSON encountered"))}},addLayers(t){for(let e=t.length-1;e>=0;e--){const i=this._layers[t[e]];i&&(!this.options.timeField||this._featureWithinTimeRange(i.feature))&&(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0))}},removeLayers(t,e){for(let i=t.length-1;i>=0;i--){const s=t[i],r=this._layers[s];r&&(this.fire("removefeature",{feature:r.feature,permanent:e},!0),this._map.removeLayer(r)),r&&e&&delete this._layers[s]}},cellEnter(t,e){this._visibleZoom()&&!this._zooming&&this._map&&a.Util.requestAnimFrame(a.Util.bind(function(){const i=this._cacheKey(e),s=this._cellCoordsToKey(e),r=this._cache[i];this._activeCells[s]&&r&&this.addLayers(r)},this))},cellLeave(t,e){this._zooming||a.Util.requestAnimFrame(a.Util.bind(function(){if(this._map){const i=this._cacheKey(e),s=this._cellCoordsToKey(e),r=this._cache[i],o=this._map.getBounds();if(!this._activeCells[s]&&r){let n=!0;for(let l=0;l<r.length;l++){const u=this._layers[r[l]];u&&u.getBounds&&o.intersects(u.getBounds())&&(n=!1)}n&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&n&&(delete this._cache[i],delete this._cells[s],delete this._activeCells[s])}}},this))},resetStyle(){return this.options.style=this._originalStyle,this.eachFeature(function(t){this.resetFeatureStyle(t.feature.id)},this),this},setStyle(t){return this.options.style=t,this.eachFeature(function(e){this.setFeatureStyle(e.feature.id,t)},this),this},resetFeatureStyle(t){const e=this._layers[t],i=this._originalStyle||a.Path.prototype.options;return e&&(a.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle(t,e){const i=this._layers[t];return typeof e=="function"&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature(t,e){if(this._map){const i=this._map.getBounds();for(const s in this._layers)this._currentSnapshot.indexOf(this._layers[s].feature.id)!==-1&&(typeof this._layers[s].getLatLng=="function"&&i.contains(this._layers[s].getLatLng())?t.call(e,this._layers[s]):typeof this._layers[s].getBounds=="function"&&i.intersects(this._layers[s].getBounds())&&t.call(e,this._layers[s]))}return this},eachFeature(t,e){for(const i in this._layers)t.call(e,this._layers[i]);return this},getFeature(t){return this._layers[t]},bringToBack(){this.eachFeature(t=>{t.bringToBack&&t.bringToBack()})},bringToFront(){this.eachFeature(t=>{t.bringToFront&&t.bringToFront()})},redraw(t){return t&&this._redraw(t),this},_redraw(t){const e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){const r=this.options.pointToLayer(i,a.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options.icon;e.setIcon(r)}if(e&&e.setStyle&&this.options.pointToLayer){const r=this.options.pointToLayer(i,a.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options;this.setFeatureStyle(i.id,r)}e&&e.setStyle&&this.options.style&&this.resetFeatureStyle(i.id)},openPopup(t){return this._popup&&this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(t){return this._tooltip&&this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});function Wt(t){return new qt(t)}export{qt as A,k as B,Wt as C,Gt as D,Ut as E,xt as F,W as I,Ct as M,bt as Q,at as R,_ as S,O as T,Lt as a,It as b,At as c,Tt as d,F as e,St as f,z as g,wt as h,Bt as i,Rt as j,Pt as k,Ot as l,ot as m,zt as n,lt as o,nt as p,$ as q,Q as r,Dt as s,kt as t,Zt as u,Et as v,Nt as w,ut as x,$t as y,E as z};
