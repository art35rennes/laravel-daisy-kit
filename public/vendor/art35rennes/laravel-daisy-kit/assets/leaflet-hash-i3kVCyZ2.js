(function(n){var i=(function(){var t=n.documentMode;return"onhashchange"in n&&(t===void 0||t>7)})();L.Hash=function(t){this.onHashChange=L.Util.bind(this.onHashChange,this),t&&this.init(t)},L.Hash.parseHash=function(t){t.indexOf("#")===0&&(t=t.substr(1));var e=t.split("/");if(e.length==3){var a=parseInt(e[0],10),s=parseFloat(e[1]),h=parseFloat(e[2]);return isNaN(a)||isNaN(s)||isNaN(h)?!1:{center:new L.LatLng(s,h),zoom:a}}else return!1},L.Hash.formatHash=function(t){var e=t.getCenter(),a=t.getZoom(),s=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return"#"+[a,e.lat.toFixed(s),e.lng.toFixed(s)].join("/")},L.Hash.prototype={map:null,lastHash:null,parseHash:L.Hash.parseHash,formatHash:L.Hash.formatHash,init:function(t){this.map=t,this.lastHash=null,this.onHashChange(),this.isListening||this.startListening()},removeFrom:function(t){this.changeTimeout&&clearTimeout(this.changeTimeout),this.isListening&&this.stopListening(),this.map=null},onMapMove:function(){if(this.movingMap||!this.map._loaded)return!1;var t=this.formatHash(this.map);this.lastHash!=t&&(location.replace(t),this.lastHash=t)},movingMap:!1,update:function(){var t=location.hash;if(t!==this.lastHash){var e=this.parseHash(t);e?(this.movingMap=!0,this.map.setView(e.center,e.zoom),this.movingMap=!1):this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var t=this;this.changeTimeout=setTimeout(function(){t.update(),t.changeTimeout=null},this.changeDefer)}},isListening:!1,hashChangeInterval:null,startListening:function(){this.map.on("moveend",this.onMapMove,this),i?L.DomEvent.addListener(n,"hashchange",this.onHashChange):(clearInterval(this.hashChangeInterval),this.hashChangeInterval=setInterval(this.onHashChange,50)),this.isListening=!0},stopListening:function(){this.map.off("moveend",this.onMapMove,this),i?L.DomEvent.removeListener(n,"hashchange",this.onHashChange):clearInterval(this.hashChangeInterval),this.isListening=!1}},L.hash=function(t){return new L.Hash(t)},L.Map.prototype.addHash=function(){this._hash=L.hash(this)},L.Map.prototype.removeHash=function(){this._hash.removeFrom()}})(window);
